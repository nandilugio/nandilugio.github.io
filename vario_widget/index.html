<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
</head>
<body>
  <h1>Vario Widget</h1>
  <pre style="border:1px solid black; background-color: lightgray" id="container"></pre>

  <script>
    // TODO: remove
    const STUB_SKEWT_DATA = '{"dalrtops":[[1550,839.9,22.05]],"uid":"cb","wdir":[[110.4,110.4,110.4,108.6,108,108,107.5,107.5,107.5,107.5,107.5,107.2,107.2,107.2,107.3,107,107.3,107.1,106.8,104.2,97.7,89.3,79,72.8,67,61.4,57.5,54.3,54.1,54.4,55.4,56.9,58.2,59.8,61.2,62.5,63.6,64.3,64.6,64.9,65.2,65.5,65.8,66.2,66.5,66.8,66.9,66.9,66.9,66.8,66.7,66.8,66.9,67.1,67.3,67.6,67.8,67.9,68.1,68.3,68.5,68.6,68.9,69.1,69.4,69.6,69.9,70.1,70.2,70.3,70.4,70.5,70.5,70.5,70.3,70.1,69.9,69.7,69.6,69.4,69.3,69.3,69.3,69.2,69.2,69.1,69,68.8,68.7,68.5,68.3,68.1,68,68.1,68.3,68.5,68.7,68.9,69.1,69.3,69.4,69.3,69.2,69.1,69,68.9,68.8,68.7,68.3,68,67.7,67.3,66.9,66.6,66.2,65.9,65.5,65.2,64.8,64.5,64.1,63.7,63.4,63.5,63.7,63.8,64,64.2,64.3,64.5,64.6,64.6,64.7,64.7,64.7,64.8,64.8,64.8,64.7,64.6,64.5,64.3,64.2,64.1,63.9,63.7,63.4,63,62.7,62.3,61.9,61.6,61.2,61.2,61.7,62.2,62.6,63.1,63.5,64,64.4,65,65.5,66.1,66.6,67.2,67.7,68.2,68.7,68.6,68.5,68.3,68.1,68,67.8,67.7,67.5,67.2,67,66.7,66.5,66.2,66,65.7,65.6,65.8,65.9,66,66.2,66.3,66.5,66.6,66.6,66.5,66.4,66.3,66.2,66.1,66,65.9,65.9,65.9,65.8,65.8,65.8,65.8,65.8,65.8,65.9,65.9,65.9,66,66,66,66.1]],"hgts":[700,750,800,850,900,950,1000,1050,1100,1150,1200,1250,1300,1350,1400,1450,1500,1550,1600,1650,1700,1750,1800,1850,1900,1950,2000,2050,2100,2150,2200,2250,2300,2350,2400,2450,2500,2550,2600,2650,2700,2750,2800,2850,2900,2950,3000,3050,3100,3150,3200,3250,3300,3350,3400,3450,3500,3550,3600,3650,3700,3750,3800,3850,3900,3950,4000,4050,4100,4150,4200,4250,4300,4350,4400,4450,4500,4550,4600,4650,4700,4750,4800,4850,4900,4950,5000,5050,5100,5150,5200,5250,5300,5350,5400,5450,5500,5550,5600,5650,5700,5750,5800,5850,5900,5950,6000,6050,6100,6150,6200,6250,6300,6350,6400,6450,6500,6550,6600,6650,6700,6750,6800,6850,6900,6950,7000,7050,7100,7150,7200,7250,7300,7350,7400,7450,7500,7550,7600,7650,7700,7750,7800,7850,7900,7950,8000,8050,8100,8150,8200,8250,8300,8350,8400,8450,8500,8550,8600,8650,8700,8750,8800,8850,8900,8950,9000,9050,9100,9150,9200,9250,9300,9350,9400,9450,9500,9550,9600,9650,9700,9750,9800,9850,9900,9950,10000,10050,10100,10150,10200,10250,10300,10350,10400,10450,10500,10550,10600,10650,10700,10750,10800,10850,10900,10950,11000,11050,11100,11150,11200,11250,11300,11350,11400],"press":[[932,926,920,915,909,903,898,892,887,881,876,871,866,860,855,850,845,840,835,830,825,820,815,810,805,800,796,791,786,781,777,772,767,763,758,754,749,744,740,735,731,727,722,718,713,709,705,700,696,692,688,683,679,675,671,667,662,658,654,650,646,642,638,634,630,626,622,618,614,611,607,603,599,595,592,588,584,580,577,573,569,566,562,558,555,551,548,544,540,537,533,530,526,523,520,516,513,510,506,503,499,496,493,490,487,484,480,477,474,471,468,465,462,459,456,453,450,447,444,441,438,435,432,429,426,423,420,418,415,412,409,406,404,401,398,396,393,390,387,385,382,380,377,374,372,369,367,364,362,359,357,354,352,349,347,345,342,340,338,335,333,330,328,326,324,321,319,317,315,312,310,308,306,304,301,299,297,295,293,291,289,287,284,282,280,278,276,274,272,270,268,266,264,262,261,259,257,255,253,251,249,247,245,244,242,240,238,236,235,233,231,229,228,226,224]],"tmps":[[31.48,30.75,30.01,29.38,28.8,28.24,27.7,27.17,26.66,26.14,25.61,25.08,24.56,24.06,23.55,23.05,22.55,22.05,21.59,21.17,20.74,20.34,19.95,19.58,19.21,18.91,18.65,18.4,18.14,17.86,17.58,17.3,17.01,16.71,16.39,16.07,15.75,15.44,15.14,14.85,14.55,14.25,13.91,13.55,13.19,12.83,12.46,12.06,11.66,11.26,10.86,10.43,9.98,9.53,9.08,8.63,8.19,7.75,7.31,6.88,6.44,6.01,5.59,5.17,4.75,4.33,3.91,3.49,3.07,2.64,2.22,1.8,1.38,0.95,0.51,0.07,-0.37,-0.81,-1.25,-1.69,-2.13,-2.56,-3,-3.43,-3.87,-4.3,-4.73,-5.16,-5.59,-6.01,-6.44,-6.87,-7.3,-7.69,-8.07,-8.44,-8.81,-9.19,-9.56,-9.94,-10.3,-10.65,-11.01,-11.36,-11.72,-12.07,-12.43,-12.78,-13.13,-13.49,-13.84,-14.19,-14.55,-14.9,-15.25,-15.6,-15.93,-16.27,-16.61,-16.95,-17.28,-17.62,-17.96,-18.3,-18.64,-18.98,-19.32,-19.66,-20.01,-20.35,-20.64,-20.87,-21.1,-21.34,-21.57,-21.81,-22.04,-22.27,-22.55,-22.84,-23.13,-23.41,-23.7,-23.99,-24.27,-24.56,-24.82,-25.09,-25.36,-25.63,-25.89,-26.16,-26.43,-26.71,-27.01,-27.3,-27.6,-27.89,-28.19,-28.48,-28.78,-29.17,-29.58,-29.99,-30.41,-30.82,-31.23,-31.65,-32.06,-32.47,-32.88,-33.29,-33.7,-34.11,-34.52,-34.94,-35.35,-35.77,-36.19,-36.61,-37.03,-37.46,-37.88,-38.3,-38.7,-39.08,-39.45,-39.83,-40.2,-40.57,-40.95,-41.32,-41.7,-42.07,-42.45,-42.82,-43.2,-43.58,-43.95,-44.33,-44.69,-45.05,-45.4,-45.76,-46.11,-46.47,-46.82,-47.18,-47.55,-47.93,-48.31,-48.69,-49.07,-49.45,-49.83]],"dates":[1660492800],"dps":[[11.7,11.6,11.4,11.3,11.3,11.2,11.1,11,11,10.9,10.8,10.7,10.7,10.6,10.5,10.4,10.4,10.3,10.2,10.1,9.9,9.8,9.6,9.5,9.3,9,8.6,8.2,7.8,7.2,6.5,5.8,5,4.3,3.6,2.8,2.1,1.4,0.8,0.1,-0.5,-1.1,-1.5,-1.9,-2.2,-2.6,-2.8,-2.9,-3,-3,-3.1,-3.2,-3.3,-3.4,-3.6,-3.7,-3.9,-4.1,-4.3,-4.5,-4.7,-4.9,-5.1,-5.2,-5.4,-5.6,-5.8,-5.9,-6.1,-6.2,-6.4,-6.5,-6.7,-6.8,-6.9,-7,-7.1,-7.2,-7.3,-7.4,-7.5,-7.6,-7.6,-7.7,-7.8,-8,-8.1,-8.3,-8.4,-8.6,-8.8,-9,-9.2,-9.7,-10.3,-11,-11.6,-12.3,-13,-13.6,-14.2,-14.6,-15,-15.4,-15.8,-16.2,-16.6,-17.1,-17.9,-18.7,-19.5,-20.4,-21.2,-22.1,-23,-24,-25.1,-26.2,-27.3,-28.5,-29.8,-31.2,-32.5,-33.6,-34.6,-35.7,-36.9,-38.1,-39.4,-40.8,-41.6,-41.8,-42,-42.3,-42.5,-42.7,-43,-43.2,-43.3,-43.4,-43.5,-43.6,-43.7,-43.9,-44,-44.1,-44.5,-44.8,-45.1,-45.5,-45.8,-46.2,-46.5,-46.8,-47.2,-47.5,-47.8,-48.1,-48.5,-48.8,-49.1,-49.3,-49.5,-49.7,-49.9,-50.1,-50.2,-50.4,-50.6,-50.8,-51,-51.2,-51.4,-51.6,-51.8,-52,-52.2,-52.4,-52.6,-52.8,-53,-53.2,-53.4,-53.6,-53.9,-54.4,-54.8,-55.3,-55.7,-56.1,-56.6,-57,-57.5,-57.9,-58.3,-58.8,-59.2,-59.6,-60,-60.5,-60.8,-61.2,-61.5,-61.9,-62.2,-62.6,-62.9,-63.2,-63.5,-63.8,-64,-64.3,-64.5,-64.8,-65]],"shgt":745,"spress":[910.4],"wspd":[[5,5,5,5.4,5.6,5.6,5.8,5.8,5.8,5.8,5.8,5.9,5.9,5.9,5.8,5.7,5.6,5.5,5.3,5,4.5,4.1,3.9,4,4.1,4.3,4.7,5.2,5.7,6.2,7,7.9,8.7,9.6,10.4,11.1,11.9,12.5,13.1,13.7,14.3,14.8,15.4,15.9,16.5,17,17.4,17.7,18,18.3,18.5,18.7,18.9,19.1,19.3,19.5,19.6,19.8,19.9,20.1,20.2,20.4,20.6,20.8,21.1,21.3,21.6,21.9,22.3,22.7,23.1,23.4,23.8,24.2,24.5,24.7,25,25.3,25.6,25.9,26.3,26.6,27,27.3,27.7,28,28.3,28.5,28.7,28.9,29.1,29.4,29.6,29.5,29.4,29.2,29.1,28.9,28.8,28.7,28.5,28.3,28.1,27.9,27.7,27.5,27.4,27.2,27,26.8,26.6,26.4,26.2,26,25.9,25.7,25.5,25.4,25.2,25.1,24.9,24.8,24.7,24.5,24.4,24.3,24.2,24.1,23.9,23.8,23.7,23.6,23.5,23.5,23.4,23.3,23.2,23.1,23.1,23.2,23.2,23.3,23.4,23.4,23.5,23.5,23.4,23.3,23.2,23.1,23,22.9,22.8,22.8,22.8,22.8,22.8,22.8,22.8,22.7,22.7,22.8,22.9,22.9,23,23.1,23.1,23.2,23.3,23.4,23.4,23.5,23.6,23.7,23.7,23.8,23.9,24.1,24.3,24.5,24.6,24.8,25,25.2,25.4,25.6,25.8,26.1,26.3,26.5,26.7,26.9,27.1,27.3,27.5,27.7,27.9,28.1,28.2,28.4,28.6,28.8,29,29.2,29.4,29.6,29.8,30,30.1,30,30,30,30,30,30]],"tmp2m":[33.07]}';
  </script>

  <script type="module">
		
    function display(txt) {
      const div = document.getElementById("container");
      div.innerHTML += txt;
		}

    async function fetch_skewt_data(lat, lon) {
      // const url = `https://n3.xcskies.com/skewt/iconeu/20220814/16/00?lat=${lat}&lon=${lon}&single=1`;
      // const response = await fetch(url);
      // const body = await response.text();
      // const json_data = body.slice(3, -1);
      const json_data = STUB_SKEWT_DATA;
      return JSON.parse(json_data);
    }

    function get_geopos() {
      const options = {
        enableHighAccuracy: true,
        timeout: 5000,
        maximumAge: 0
      };

		  return new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, reject, options);
      });
    }

    try {
      const geopos = await get_geopos();
      const crd = geopos.coords;
      display(`Lat: ${crd.latitude} Lon: ${crd.longitude} Alt: ${crd.altitude}\n`);

      const skewt_data = await fetch_skewt_data(crd.latitude, crd.longitude);
      display(`Data: ${JSON.stringify(skewt_data).slice(0, 50)}...\n`)
      
      document.app = {geopos, skewt_data}; // TODO: debug, remove

    } catch (error) {
      display(error);
      throw error;
    }
  </script>
</body>
</html>

